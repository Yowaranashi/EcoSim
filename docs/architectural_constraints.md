# Архитектурные ограничения существующей системы EcoSim

Документ фиксирует текущие архитектурные ограничения проекта, которые важно учитывать при развитии системы.

## 1. Общие ограничения архитектуры

- Система построена как модульное монолитное приложение на C++ (без выделенных внешних сервисов).
- Жизненный цикл модулей централизованно управляется через `ModuleManager` и реестр модулей.
- Связывание модулей преимущественно происходит в рамках процесса, через события и порты, без сетевой изоляции.

## 2. Ограничения модульной модели

- Каждый модуль должен соответствовать контракту базового класса модуля (`module.h`).
- Порядок запуска модулей критичен и должен быть детерминирован.
- Ошибки инициализации одного критичного модуля могут остановить старт всего приложения.
- Метаданные модулей задаются через `manifest.toml`; изменение структуры манифеста требует синхронных правок в загрузчике.

## 3. Ограничения взаимодействия (Event Bus)

- Взаимодействие через `EventBus` не обеспечивает строгой типовой изоляции на уровне доменных границ.
- Гарантии доставки/порядка событий ограничены реализацией текущей in-process шины.
- Долгие обработчики событий потенциально блокируют реакцию подписчиков при последовательной обработке.
- Отсутствует встроенный механизм распределённой доставки событий (outbox, брокер сообщений и т.д.).

## 4. Ограничения по данным и конфигурации

- Конфигурация загружается из TOML-файлов; ошибки структуры/обязательных полей выявляются во время старта.
- Отсутствие критичных параметров в конфигурации приводит к отказу запуска (fail-fast).
- Конфигурация в текущем виде не предполагает "горячего" изменения во время выполнения.
- Сценарии выполнения задаются заранее и ограничены форматом, поддерживаемым `scenario` и `scenario_runner`.

## 5. Ограничения выполнения сценариев

- `ScenarioRunner` является координатором выполнения и зависит от корректной готовности остальных модулей.
- Валидация сценарных данных ограничена правилами, реализованными в текущем ядре.
- Поведение системы в первую очередь ориентировано на офлайн/батч-прогон сценария, а не на интерактивные сессии.

## 6. Ограничения подсистемы симуляции мира и агентов

- Модуль мира (`simulation_world`) предоставляет общий контекст состояния, от которого зависят другие модули.
- Логика поведения агентов (`agent_behavoir`) ограничена существующими интерфейсами доступа к миру (`world_port`).
- Расширение модели мира или агентов обычно требует синхронных правок в нескольких модулях.

## 7. Ограничения записи результатов

- Запись результатов ориентирована на CSV (`recorder_csv`), что ограничивает выразительность формата и типизацию данных.
- Добавление новых форматов экспорта требует отдельной модульной реализации.
- При больших объёмах данных CSV-подход может создавать узкие места по I/O и пост-обработке.

## 8. Ограничения наблюдаемости и эксплуатации

- Логирование и консольный вывод реализованы как базовые инфраструктурные подсистемы.
- Отсутствует полноценная встроенная система метрик/трейсинга уровня production observability.
- Диагностика сложных инцидентов в основном опирается на логи и тестовые сценарии.

## 9. Ограничения тестирования

- Набор тестов покрывает ключевые интеграционные аспекты (старт модулей, порядок, доставку событий, результаты сценария), но не гарантирует полную защиту от регрессий во всех комбинациях модулей.
- Конфигурационные и сценарные кейсы в тестах задаются через фиксированные TOML-файлы.
- Для новых архитектурных возможностей может потребоваться расширение тестовой инфраструктуры и тест-данных.

## 10. Практические выводы для развития

- При добавлении новых модулей обязательно учитывать порядок инициализации и точки интеграции в `ModuleManager`/`ModuleRegistry`.
- При расширении событийной модели важно контролировать влияние на производительность и порядок обработки событий.
- Изменения форматов конфигурации и сценариев следует сопровождать обратной совместимостью или миграционными шагами.
- Для масштабирования функциональности записи результатов желательно абстрагировать формат хранения и экспорт.
